<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü•´ PƒÅtaka Pal</title>
    
    <!-- External Libraries -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qr-scanner/1.4.2/qr-scanner.umd.min.js"></script>
    
    <!-- Our Styles -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <h1>ü•´ PƒÅtaka Pal</h1>
            <p>Find and share food in your neighbourhood</p>
        </div>

        <!-- Find Tab -->
        <div id="findView" class="tab-content active">
            <!-- Search Container -->
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="üîç Search patakas, locations, or food items..." class="search-input">
                <div class="view-toggle">
                    <button id="mapBtn" class="toggle-btn active">üó∫Ô∏è Map View</button>
                    <button id="listBtn" class="toggle-btn">üìã List View</button>
                </div>
            </div>

            <!-- Map View -->
            <div id="mapView" class="map-container">
                <div id="azureMap" class="map"></div>
            </div>

            <!-- List View -->
            <div id="listView" class="list-container hidden">
                <div id="cupboardsList" class="cupboards-list">
                    <!-- PƒÅtaka list will be populated here -->
                </div>
            </div>
        </div>

        <!-- Donate Tab -->
        <div id="donateView" class="tab-content">
            <!-- Step 1: QR Scanner -->
            <div id="donateSection1" class="action-section active">
                <div class="step-indicator">
                    <div id="donateStep1" class="step active">1</div>
                    <div id="donateStep2" class="step">2</div>
                    <div id="donateStep3" class="step">3</div>
                    <div id="donateStep4" class="step">4</div>
                </div>
                
                <div class="section-content">
                    <h2>üì± Scan PƒÅtaka QR Code</h2>
                    <p>Point your camera at the QR code on the pƒÅtaka</p>
                    <video id="donateQRVideo" class="qr-video" playsinline></video>
                    <div class="action-buttons">
                        <button id="donateUnableToScanBtn" class="btn btn-secondary">Unable to scan QR code?</button>
                        <button id="cancelDonateBtn" class="btn btn-secondary">Cancel</button>
                    </div>
                </div>
            </div>

            <!-- Step 1b: Manual Selection -->
            <div id="donateSection1b" class="action-section">
                <div class="step-indicator">
                    <div class="step active">1</div>
                    <div class="step">2</div>
                    <div class="step">3</div>
                    <div class="step">4</div>
                </div>
                
                <div class="section-content">
                    <h2>üìç Select PƒÅtaka</h2>
                    <p>Choose the pƒÅtaka you're donating to</p>
                    <div class="form-group">
                        <select id="donatePatakaSelect" class="form-select">
                            <option value="">Choose a pataka...</option>
                        </select>
                    </div>
                    <div class="action-buttons">
                        <button id="backToDonateQRBtn" class="btn btn-secondary">Back to QR Scan</button>
                    </div>
                </div>
            </div>

            <!-- Step 2: Photo -->
            <div id="donateSection2" class="action-section">
                <div class="step-indicator">
                    <div class="step completed">1</div>
                    <div class="step active">2</div>
                    <div class="step">3</div>
                    <div class="step">4</div>
                </div>
                
                <div class="section-content">
                    <h2>üì∑ Photo (Optional)</h2>
                    <p>Take a photo of the food you're donating for AI analysis</p>
                    <p><strong>Donating to:</strong> <span id="donateSelectedPatakaName"></span></p>
                    
                    <div class="photo-buttons">
                        <input type="file" id="donateTakePhotoInput" accept="image/*" capture="environment" style="display: none;">
                        <input type="file" id="donateSelectPhotoInput" accept="image/*" style="display: none;">
                        <button id="donateTakePhotoBtn" class="btn btn-primary">üì∑ Take Photo</button>
                        <button id="donateSelectPhotoBtn" class="btn btn-secondary">üìÅ Select Photo</button>
                    </div>
                    
                    <div id="donatePhotoPreviewContainer" class="photo-preview-container hidden">
                        <img id="donatePhotoPreview" class="photo-preview" alt="Photo preview">
                    </div>
                    
                    <div class="action-buttons">
                        <button id="donateAnalyzePhotoBtn" class="btn btn-primary">üîç Analyze Photo</button>
                        <button id="donateSkipPhotoBtn" class="btn btn-secondary">Skip Photo</button>
                        <button id="donatePhotoBackBtn" class="btn btn-secondary">Back</button>
                    </div>
                </div>
            </div>

            <!-- Step 3: Items Review -->
            <div id="donateSection3" class="action-section">
                <div class="step-indicator">
                    <div class="step completed">1</div>
                    <div class="step completed">2</div>
                    <div class="step active">3</div>
                    <div class="step">4</div>
                </div>
                
                <div class="section-content">
                    <h2>ü•´ Review Items</h2>
                    <p>Confirm the items you're donating</p>
                    
                    <div id="donateDetectedItems" class="detected-items">
                        <!-- AI detected items will appear here -->
                    </div>
                    
                    <div class="manual-add-section">
                        <h4>Add Item Manually</h4>
                        <div class="form-group">
                            <input type="text" id="donateManualItemName" class="form-input" placeholder="Item name">
                        </div>
                        <div class="form-group">
                            <input type="number" id="donateManualItemQty" class="form-input" min="1" value="1" placeholder="Quantity">
                        </div>
                        <button id="donateAddManualBtn" class="btn btn-secondary">Add Item</button>
                    </div>
                    
                    <div class="action-buttons">
                        <button id="donateAINextBtn" class="btn btn-primary">Next</button>
                        <button id="donateAIBackBtn" class="btn btn-secondary">Back</button>
                    </div>
                </div>
            </div>

            <!-- Step 4: Comment -->
            <div id="donateSection4" class="action-section">
                <div class="step-indicator">
                    <div class="step completed">1</div>
                    <div class="step completed">2</div>
                    <div class="step completed">3</div>
                    <div class="step active">4</div>
                </div>
                
                <div class="section-content">
                    <h2>üí¨ Message (Optional)</h2>
                    <p>Add a message for the community</p>
                    
                    <div class="form-group">
                        <textarea id="donateCommentInput" class="form-textarea" placeholder="e.g., Fresh from my garden, Use by tomorrow, etc."></textarea>
                    </div>
                    
                    <div class="action-buttons">
                        <button id="donateSubmitBtn" class="btn btn-primary">üéâ Submit Donation</button>
                        <button id="donateCommentBackBtn" class="btn btn-secondary">Back</button>
                    </div>
                </div>
            </div>

            <!-- Success -->
            <div id="donateSuccess" class="action-section">
                <div class="section-content">
                    <div class="success-message">
                        <h3>üéâ Donation Successful!</h3>
                        <p>Thank you for your generous donation!</p>
                        <p>Your contribution helps feed our community.</p>
                    </div>
                    <div class="action-buttons">
                        <button id="donateBackToMapBtn" class="btn btn-primary">Back to Map</button>
                        <button onclick="setActiveTab('donate')" class="btn btn-secondary">Donate Again</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Take Tab -->
        <div id="takeView" class="tab-content">
            <!-- Step 1: QR Scanner -->
            <div id="takeSection1" class="action-section active">
                <div class="step-indicator">
                    <div id="takeStep1" class="step active">1</div>
                    <div id="takeStep2" class="step">2</div>
                    <div id="takeStep3" class="step">3</div>
                    <div id="takeStep4" class="step">4</div>
                </div>
                
                <div class="section-content">
                    <h2>üì± Scan PƒÅtaka QR Code</h2>
                    <p>Point your camera at the QR code on the pƒÅtaka</p>
                    <video id="takeQRVideo" class="qr-video" playsinline></video>
                    <div class="action-buttons">
                        <button id="takeUnableToScanBtn" class="btn btn-secondary">Unable to scan QR code?</button>
                        <button id="cancelTakeBtn" class="btn btn-secondary">Cancel</button>
                    </div>
                </div>
            </div>

            <!-- Step 1b: Manual Selection -->
            <div id="takeSection1b" class="action-section">
                <div class="step-indicator">
                    <div class="step active">1</div>
                    <div class="step">2</div>
                    <div class="step">3</div>
                    <div class="step">4</div>
                </div>
                
                <div class="section-content">
                    <h2>üìç Select PƒÅtaka</h2>
                    <p>Choose the pƒÅtaka you're taking from</p>
                    <div class="form-group">
                        <select id="takePatakaSelect" class="form-select">
                            <option value="">Choose a pataka...</option>
                        </select>
                    </div>
                    <div class="action-buttons">
                        <button id="backToTakeQRBtn" class="btn btn-secondary">Back to QR Scan</button>
                    </div>
                </div>
            </div>

            <!-- Additional take sections similar to donate... -->
            <div id="takeSection2" class="action-section">
                <div class="step-indicator">
                    <div class="step completed">1</div>
                    <div class="step active">2</div>
                    <div class="step">3</div>
                    <div class="step">4</div>
                </div>
                
                <div class="section-content">
                    <h2>üì∑ Photo (Optional)</h2>
                    <p>Take a photo of what you're taking for record keeping</p>
                    <p><strong>Taking from:</strong> <span id="takeSelectedPatakaName"></span></p>
                    
                    <div class="photo-buttons">
                        <input type="file" id="takeTakePhotoInput" accept="image/*" capture="environment" style="display: none;">
                        <input type="file" id="takeSelectPhotoInput" accept="image/*" style="display: none;">
                        <button id="takeTakePhotoBtn" class="btn btn-primary">üì∑ Take Photo</button>
                        <button id="takeSelectPhotoBtn" class="btn btn-secondary">üìÅ Select Photo</button>
                    </div>
                    
                    <div id="takePhotoPreviewContainer" class="photo-preview-container hidden">
                        <img id="takePhotoPreview" class="photo-preview" alt="Photo preview">
                    </div>
                    
                    <div class="action-buttons">
                        <button id="takeAnalyzePhotoBtn" class="btn btn-primary">üîç Analyze Photo</button>
                        <button id="takeSkipPhotoBtn" class="btn btn-secondary">Skip Photo</button>
                        <button id="takePhotoBackBtn" class="btn btn-secondary">Back</button>
                    </div>
                </div>
            </div>

            <div id="takeSection3" class="action-section">
                <div class="step-indicator">
                    <div class="step completed">1</div>
                    <div class="step completed">2</div>
                    <div class="step active">3</div>
                    <div class="step">4</div>
                </div>
                
                <div class="section-content">
                    <h2>ü•´ Select Items</h2>
                    <p>Choose what you're taking from the pƒÅtaka</p>
                    
                    <div id="takeAvailableItems" class="available-items">
                        <!-- Available items will appear here -->
                    </div>
                    
                    <div class="manual-add-section">
                        <h4>Add Item Manually</h4>
                        <div class="form-group">
                            <input type="text" id="takeManualItemName" class="form-input" placeholder="Item name">
                        </div>
                        <div class="form-group">
                            <input type="number" id="takeManualItemQty" class="form-input" min="1" value="1" placeholder="Quantity">
                        </div>
                        <button id="takeAddManualBtn" class="btn btn-secondary">Add Item</button>
                    </div>
                    
                    <div class="action-buttons">
                        <button id="takeItemsNextBtn" class="btn btn-primary">Next</button>
                        <button id="takeItemsBackBtn" class="btn btn-secondary">Back</button>
                    </div>
                </div>
            </div>

            <div id="takeSection4" class="action-section">
                <div class="step-indicator">
                    <div class="step completed">1</div>
                    <div class="step completed">2</div>
                    <div class="step completed">3</div>
                    <div class="step active">4</div>
                </div>
                
                <div class="section-content">
                    <h2>üìã Summary</h2>
                    <p>Review what you're taking</p>
                    
                    <div id="takeSelectedItems" class="selected-items">
                        <!-- Selected items summary will appear here -->
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Comment (Optional)</label>
                        <textarea id="takeCommentInput" class="form-textarea" placeholder="Any comments about what you took..."></textarea>
                    </div>
                    
                    <div class="action-buttons">
                        <button id="takeSubmitBtn" class="btn btn-primary">‚úÖ Submit Taking</button>
                        <button id="takeCommentBackBtn" class="btn btn-secondary">Back</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Report Tab -->
        <div id="reportView" class="tab-content">
            <!-- Step 1: QR Scanner -->
            <div id="reportSection1" class="action-section active">
                <div class="step-indicator">
                    <div id="step1" class="step active">1</div>
                    <div id="step2" class="step">2</div>
                    <div id="step3" class="step">3</div>
                </div>
                
                <div class="section-content">
                    <h2>üì± Scan PƒÅtaka QR Code</h2>
                    <p>Point your camera at the QR code on the pƒÅtaka you want to report about</p>
                    <video id="reportQRVideo" class="qr-video" playsinline></video>
                    <div class="action-buttons">
                        <button id="reportUnableToScanBtn" class="btn btn-secondary">Unable to scan QR code?</button>
                        <button id="cancelReportBtn" class="btn btn-secondary">Cancel</button>
                    </div>
                </div>
            </div>

            <!-- Step 1b: Manual Selection -->
            <div id="reportSection1b" class="action-section">
                <div class="step-indicator">
                    <div class="step active">1</div>
                    <div class="step">2</div>
                    <div class="step">3</div>
                </div>
                
                <div class="section-content">
                    <h2>üìç Select PƒÅtaka</h2>
                    <p>Choose the pƒÅtaka you want to report about</p>
                    <div class="form-group">
                        <select id="reportPatakaSelect" class="form-select">
                            <option value="">Choose a pataka...</option>
                        </select>
                    </div>
                    <div class="action-buttons">
                        <button onclick="handleManualPatakaSelection('reportPatakaSelect', 'report')" class="btn btn-primary">Continue</button>
                        <button id="backToReportQRBtn" class="btn btn-secondary">Back to QR Scan</button>
                    </div>
                </div>
            </div>

            <!-- Step 2: Report Details -->
            <div id="reportSection2" class="action-section">
                <div class="step-indicator">
                    <div class="step completed">1</div>
                    <div class="step active">2</div>
                    <div class="step">3</div>
                </div>
                
                <div class="section-content">
                    <h2>‚ö†Ô∏è Report Issue</h2>
                    <p><strong>Reporting about:</strong> <span id="selectedPatakaName"></span></p>
                    
                    <div class="form-group">
                        <label class="form-label">Issue Type</label>
                        <div class="issue-types">
                            <label><input type="radio" name="issueType" value="damaged"> Damaged/Broken</label>
                            <label><input type="radio" name="issueType" value="empty"> Empty for extended period</label>
                            <label><input type="radio" name="issueType" value="full"> Overfull/spoiled items</label>
                            <label><input type="radio" name="issueType" value="maintenance"> Needs maintenance</label>
                            <label><input type="radio" name="issueType" value="vandalism"> Vandalism</label>
                            <label><input type="radio" name="issueType" value="access"> Access issues</label>
                            <label><input type="radio" name="issueType" value="other"> Other</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea id="reportDescription" class="form-textarea" placeholder="Describe the issue..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Photo Evidence (Optional)</label>
                        <input type="file" id="reportPhotoInput" accept="image/*" style="display: none;">
                        <button id="reportTakePhotoBtn" class="btn btn-secondary">üì∑ Add Photo</button>
                        
                        <div id="reportPhotoPreviewContainer" class="photo-preview-container hidden">
                            <img id="reportPhotoPreview" class="photo-preview" alt="Photo preview">
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button id="reportNextBtn" class="btn btn-primary">Next</button>
                        <button id="reportBackBtn" class="btn btn-secondary">Back</button>
                    </div>
                </div>
            </div>

            <!-- Step 3: Contact Details -->
            <div id="reportSection3" class="action-section">
                <div class="step-indicator">
                    <div class="step completed">1</div>
                    <div class="step completed">2</div>
                    <div class="step active">3</div>
                </div>
                
                <div class="section-content">
                    <h2>üìû Contact Info (Optional)</h2>
                    <p>Leave your contact details if you'd like updates</p>
                    
                    <div id="reportSummary" class="report-summary">
                        <!-- Report summary will appear here -->
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Your Name</label>
                        <input type="text" id="reporterName" class="form-input" placeholder="Optional">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Your Email</label>
                        <input type="email" id="reporterEmail" class="form-input" placeholder="Optional">
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="okToContact"> 
                            It's okay to contact me about this issue
                        </label>
                    </div>
                    
                    <div class="action-buttons">
                        <button id="reportSubmitBtn" class="btn btn-primary">üö® Submit Report</button>
                        <button id="reportContactBackBtn" class="btn btn-secondary">Back</button>
                    </div>
                </div>
            </div>

            <!-- Success -->
            <div id="reportSuccess" class="action-section">
                <div class="section-content">
                    <div class="success-message">
                        <h3>‚úÖ Report Submitted!</h3>
                        <p>Thank you for reporting the issue!</p>
                        <p>The kaitiaki has been notified and will address the issue as soon as possible.</p>
                    </div>
                    <div class="action-buttons">
                        <button id="reportBackToMapBtn" class="btn btn-primary">Back to Map</button>
                        <button onclick="setActiveTab('report')" class="btn btn-secondary">Report Another Issue</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Navigation - BOTTOM POSITIONED -->
        <div class="tab-nav">
            <button class="tab-btn active" data-tab="find">üîç Find</button>
            <button class="tab-btn" data-tab="donate">üì§ Donate</button>
            <button class="tab-btn" data-tab="take">üì• Take</button>
            <button class="tab-btn" data-tab="report">‚ö†Ô∏è Report</button>
        </div>
    </div>

    <!-- Custom Modal -->
    <div id="customModal" class="modal hidden">
        <div class="modal-content">
            <h3 id="modalTitle">Title</h3>
            <p id="modalMessage">Message</p>
            <button id="modalCloseBtn" class="btn btn-primary">OK</button>
        </div>
    </div>

    <!-- Load JavaScript Modules -->
    <script src="js/app-core.js"></script>
    <script src="js/qr-scanner.js"></script>
    <script src="js/map-functions.js"></script>
    <script src="js/donate-workflow.js"></script>
    <script src="js/take-workflow.js"></script>
    <script src="js/report-workflow.js"></script>
</body>
</html>
